<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="once.manager.dao.ManagerDAO">
  
  	<!-- 로그인 -->
 	<select id="login" parameterType="managerVO" resultType="managerVO">
 		select staffNo, managerId, password, type, storeNo, name, telephone, date_format(date, '%y-%m-%d') as date
 		  from storeMember
 		 where managerId = #{managerId} and password = #{password}
 	</select>
  	 	
 	<!-- 패스워드 체크 -->
 	<select id="checkPassword" resultType="int">
 		select count(*)
 		from StoreMember
 		where managerId = #{managerId} and password = #{password}
 	</select>
 	
 	<!-- 회원 정보 상세 -->
 	<select id="selectOneManager" resultType="ManagerVO" parameterType="String">
 		select staffNo, managerId, password, type, storeNo, name, telephone, date_format(date, '%y-%m-%d') as date
 		from StoreMember
 		where managerId = #{managerId}
 	</select>
 	
 	<select id="selectByNo" resultType="StoreVO" parameterType="String">
 		select storeName, storeNo
 		from Store
 		where storeNo = #{storeNo}
 	</select>
 	
 	<!-- 회원 정보 수정 -->
 	<update id="modifyManager" parameterType="java.util.Map">
 		update StoreMember
 		set password = #{password}, telephone = #{telephone}
 		where managerId = #{managerId}
 	</update>
 	
 	<!-- 매니저 전체 조회 -->
 	<select id="selectAll" resultType="ManagerVO">
 		select staffNo, storeNo, type, managerId, password, name, telephone, date_format(date, '%y-%m-%d') as date
 		from StoreMember
 		order by staffNo asc;
 	</select>
 	
 	<!-- 매니저 삭제 -->
 	<delete id="delete" parameterType="String">
 		delete from StoreMember
 		where 
 		managerId = #{managerId}
 	</delete>
 	
 	<!-- 매니저 수정 -->
 	<update id="update" parameterType="java.util.Map">
 		update StoreMember
 		set telephone = #{telephone}
 		where managerId = #{managerId}
 	</update>
 	
 	<!-- 매니저 추가 -->
 	<insert id="insert" parameterType="ManagerVO">
 		insert into StoreMember(managerId, type, password, storeNo, name, telephone, date) 
 		values 
 		(#{managerId}, #{type}, #{password}, #{storeNo}, #{name}, #{telephone}, curDate()) 
 	</insert>
 	
 	<!-- storeName으로 storeNo 검색 -->
 	<select id="selectByName" parameterType="String" resultType="String">
 		select storeNo
 		from store
 		where storeName = #{storeName}
 	</select>
 	
 	<!-- 매니저 검색 -->
 	<select id="search" parameterType="String" resultType="ManagerVO">
 		select StoreMember.staffNo, StoreMember.managerId, StoreMember.name, StoreMember.telephone, date_format(date, '%y-%m-%d') as date, StoreMember.storeNo, store.storeName
 		from StoreMember left join store
		on StoreMember.storeNo = store.storeNo
 		where
 		<choose>
 			<when test="name!=null">
 				name= #{name}
 			</when>
 			<when test="managerId!=null">
 				managerId= #{managerId}
 			</when>
 			<when test="storeName!=null">
 				storeName= #{storeName}
 			</when>
 		</choose>
 	</select>
</mapper>







